
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Results Report january – Testing the Haystack Pipelines</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Retriever Module" href="../retriever/index.html" />
    <link rel="prev" title="Performance on CNIL Dataset" href="report_cnil.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lab_ia/index.html">
   LAB IA
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lab_ia/notebooks.html">
     Content with notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lab_ia/onboarding.html">
     Onboarding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lab_ia/reporting_standards.html">
     Reporting Standards
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lab_ia/resources.html">
     Resources
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../lab_ia/coding_standards/index.html">
     Coding Standards
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../lab_ia/coding_standards/deploy_project.html">
       Deploying your project to a server
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../lab_ia/coding_standards/git.html">
       Working with Git
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../lab_ia/coding_standards/jupyter.html">
       Notebooks (.ipynb)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../lab_ia/coding_standards/python.html">
       Python
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../lab_ia/coding_standards/secrets.html">
       Secrets
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   PIAF
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Reader Module
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="report_cnil.html">
       Performance on CNIL Dataset
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Results Report january – Testing the Haystack Pipelines
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../retriever/index.html">
     Retriever Module
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/DPR_fine_tuning.html">
       DPR Fine-Tuning (finally)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/DPR_performance.html">
       Why my trained DPR is (was) not working
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/ES_preprocessing.html">
       Test : Preprocessing directly with ElasticSearch Analyzers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/Visualisation_csv_results.html">
       Visualisation de l’indice de précision obtenu dans results.csv
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/Visualisation_results_Robin.html">
       Visualisation de la précision dense vs sparse
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/complementarity_dense_sparse.html">
       Analyse complémentarité
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/complementarity_dense_sparse_v2.html">
       Analyse complémentarité
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/dense_vs_sparse_qualitative.html">
       Étude des scores système dense vs sparse
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../retriever/score_threshold_sparse_retriever.html">
       Recherche d’un seuil pour le score sparse
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../howtos/index.html">
     PIAF, moteur de recherche
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../howtos/benchmark_search.html">
       Quels sont les outils simlaires ?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../howtos/fiche_produit.html">
       Piaf Application
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../howtos/integrate.html">
       Intégrer Piaf dans mon site
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../howtos/labels.html">
       Haystack Label’s Inquiry
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../csv-detective/index.html">
   CSV-DETECTIVE
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../csv-detective/analysis/index.html">
     csv-detective analysis
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../csv-detective/analysis/join_label_files.html">
       Analysis of three csv-detective manual annotations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/piaf/reader/report_january.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/psorianom/knowledge-base"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/psorianom/knowledge-base/issues/new?title=Issue%20on%20page%20%2Fpiaf/reader/report_january.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/psorianom/knowledge-base/edit/master/docs/piaf/reader/report_january.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#context">
   Context
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solution">
   Solution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sprint-content">
   Sprint content
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test">
   Test
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-objectives">
     Test objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#behaviour">
     Behaviour
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataset">
     Dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hardware">
     Hardware
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deviations">
     Deviations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-set-up">
     Test set up
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#accuracy">
     Accuracy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-for-retrieval">
     Time for retrieval
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="results-report-january-testing-the-haystack-pipelines">
<h1>Results Report january – Testing the Haystack Pipelines<a class="headerlink" href="#results-report-january-testing-the-haystack-pipelines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>At the dawn of launching a new project on the CRPA data to further test the opportunity of using PIAF in the context of the French administration, we were facing concerns regarding the standardization of the data we were to feed to PIAF.</p>
<p>We want to be able to launch a new instance of PIAF with as few human interventions as possible.
However the performance of the whole pipeline is much influenced by the size of the knowledge base available for searching.
We also know that many parameters will influence the answer retrieval in terms of quality (number of correct retrievals) and response-time.
These parameters can be: document length, number of documents retrieved, number of answers requested per documents, among others.</p>
<p>We have found out that some general feeling of how the performances are affected by the parameters can be acquired by running experiments on general purpose SQuAD-formated datasets, based on Wikipedia articles.
However, it will be necessary to fine tune every specific use case to make sure that the parameters are the best possible.
Also, this report helps us to deploy a solution that has been properly evaluated.</p>
</div>
<div class="section" id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">¶</a></h2>
<p>In order to use our solution, we first need to transform the input data into a standard format that will be used during the whole set of PIAF tools developed.</p>
<p>The natural solution was to turn the data to the SQuAD format. Our final goal is to aim at a solution where you would only have to process your data in the squad format. You would then launch the piaf annotation platform to annotate yourself the data. The annotated data will then be used to fine tune and launch your QA solution.</p>
</div>
<div class="section" id="sprint-content">
<h2>Sprint content<a class="headerlink" href="#sprint-content" title="Permalink to this headline">¶</a></h2>
<p>This sprint aims at implementing the solution allowing the evaluation of the PIAF solution.
We want to use as much as possible the functions developed by the haystack team but also implement some testing on our side for implementing a proper git flow.
We implemented this testing with the pytest library.</p>
<p>We also wanted to gain more insights as to what are the best parameters to get an optimized solution for questioning the <a class="reference external" href="http://service-public.fr">service-public.fr</a> knowledge base.</p>
</div>
<div class="section" id="test">
<h2>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-objectives">
<h3>Test objectives<a class="headerlink" href="#test-objectives" title="Permalink to this headline">¶</a></h3>
<p>Get a feeling of how the parameters can affect the performance of haystack. Either in terms of quality of answering or performances for the time of answering.</p>
</div>
<div class="section" id="behaviour">
<h3>Behaviour<a class="headerlink" href="#behaviour" title="Permalink to this headline">¶</a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD;
    Query--&gt;Retriever;
    Database--&gt;Retriever;
    Retriever--&gt;|k_retriever docs|Ranker;
    Ranker--&gt;|k_retriever * k_reader answers|10_answers;
</pre></div>
</div>
</div>
<div class="section" id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h3>
<p>The results presented in this report were generated using the dataset full_spf_squad V1.0. This datasets consists in 3068 contexts and 538 questions, of which 127 have answers.</p>
</div>
<div class="section" id="hardware">
<h3>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h3>
<p>The test was run on GPU_bro</p>
</div>
<div class="section" id="deviations">
<h3>Deviations<a class="headerlink" href="#deviations" title="Permalink to this headline">¶</a></h3>
<p>There were some unknown bug preventing from running all the tests that were intended to be done. This is especially the case for the lowest value of <code class="docutils literal notranslate"><span class="pre">split_length</span></code> (100). For more information on this bug, please check <a class="reference external" href="https://github.com/huggingface/transformers/issues/11354">this</a>.
Due to this bug, we changed the parameters that we studied. See test set up.</p>
</div>
<div class="section" id="test-set-up">
<h3>Test set up<a class="headerlink" href="#test-set-up" title="Permalink to this headline">¶</a></h3>
<p>The configurations of the Pipeline that are tested are the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;k_retriever&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
<span class="s2">&quot;k_title_retriever&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="c1"># must be present, but only used when retriever_type == title_bm25</span>
<span class="s2">&quot;k_reader_per_candidate&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
<span class="s2">&quot;k_reader_total&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
<span class="s2">&quot;retriever_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bm25&quot;</span><span class="p">],</span> <span class="c1"># Can be bm25, sbert, dpr, title or title_bm25</span>
<span class="s2">&quot;squad_dataset&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;./data/evaluation-datasets/full_spf_squad.json&quot;</span><span class="p">],</span>
<span class="s2">&quot;filter_level&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
<span class="s2">&quot;preprocessing&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">],</span>
<span class="s2">&quot;boosting&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1">#default to 1</span>
<span class="s2">&quot;split_by&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;word&quot;</span><span class="p">],</span>  <span class="c1"># Can be &quot;word&quot;, &quot;sentence&quot;, or &quot;passage&quot;</span>
<span class="s2">&quot;split_length&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10000000</span><span class="p">],</span>
<span class="s2">&quot;experiment_name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rr_20210420&quot;</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Transformers reader with “etalab-ia/camembert-base-squadFR-fquad-piaf” model</p></li>
<li><p>The embedding retriever is using the following model: <a class="reference external" href="https://huggingface.co/distilbert-base-multilingual-cased">https://huggingface.co/distilbert-base-multilingual-cased</a></p></li>
</ul>
<p>Each question of the dataset is queried to the Pipeline, and we verify the Pipeline answer vs the answer annotated in full_spf_squad.</p>
</div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<div class="section" id="accuracy">
<h3>Accuracy<a class="headerlink" href="#accuracy" title="Permalink to this headline">¶</a></h3>
<p>If the answer given by the pipeline is contained or contains the correct answer, then the answer is considered valid. The accuracy is the percentage of valid answers over the query passed to the pipeline.</p>
<p>The top1 accuracy is the accuracy of the pipeline, considering only the first answer. The <code class="docutils literal notranslate"><span class="pre">topk</span></code> accuracy is the accuracy of the pipeline using all of the 10 answers given at the end of the pipeline.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">k_reader_total</span> <span class="pre">(ou</span> <span class="pre">k_display)</span> <span class="pre">=</span> <span class="pre">5</span></code>
Best results are achieved with a low <code class="docutils literal notranslate"><span class="pre">k_retriever</span></code>. Above <code class="docutils literal notranslate"><span class="pre">k_reader_per_candidate</span> <span class="pre">=</span> <span class="pre">5</span></code>, there is no impact of this parameter on the results
<img alt="Topk accuracy VS k_retriever" src="../../_images/output_14_0.png" /></p>
<p>There is a quite low probability of finding the answer in the top. This probability strongly depends from the <code class="docutils literal notranslate"><span class="pre">k_retriever</span></code> but is not affected by <code class="docutils literal notranslate"><span class="pre">k_reader_per_candidate</span></code>
<img alt="Top1 accuracy VS k_retriever" src="../../_images/output_23_0.png" /></p>
<p>As one could expect, increasing the <code class="docutils literal notranslate"><span class="pre">k_reader_total</span></code> increases the chances of finding the correct answer. However, for the user experience to be optimal, we believe that no more than 5 answers should be diplayed for a query.
Here is an exemple with <code class="docutils literal notranslate"><span class="pre">k_reader_total</span> <span class="pre">=</span> <span class="pre">20</span></code>
<img alt="Topk accuracy VS k_retriever" src="../../_images/output_20_0.png" /></p>
<p>We modelize the behavior of the performance VS the parameters <code class="docutils literal notranslate"><span class="pre">['k_reader_per_candidate',</span> <span class="pre">'k_reader_total',</span> <span class="pre">'k_retriever']</span></code> with a polynomial equation of degree 3. <code class="docutils literal notranslate"><span class="pre">R²</span> <span class="pre">=</span> <span class="pre">0.933</span></code>.</p>
<p>The parameters having the most impact on the results are <code class="docutils literal notranslate"><span class="pre">['k_reader_per_candidate',</span> <span class="pre">'k_retriever','k_reader_per_candidate</span> <span class="pre">k_reader_total']</span></code>
<img alt="Partial_dependance" src="../../_images/output_30_1.png" /></p>
<p><img alt="Partial_dependance_2" src="../../_images/output_31_1.png" /></p>
</div>
<div class="section" id="time-for-retrieval">
<h3>Time for retrieval<a class="headerlink" href="#time-for-retrieval" title="Permalink to this headline">¶</a></h3>
<p>The time for question answering increases linearly when <code class="docutils literal notranslate"><span class="pre">k_retriever</span></code> increases.<br />
<img alt="Question Answering Time VS k_retriever" src="../../_images/output_35_0.png" /></p>
<p>The time for question answering increases  when <code class="docutils literal notranslate"><span class="pre">k_reader_per_candidate</span></code> increases.<br />
<img alt="Question Answering Time VS k_retriever" src="../../_images/output_36_0.png" /></p>
<p>The time for question answering is mainly related to <code class="docutils literal notranslate"><span class="pre">k_retriever</span></code>
<img alt="Question Answering Time VS k_retriever" src="../../_images/output_40_1.png" /></p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>We saw on this dataset that the best performances are achieved with low <code class="docutils literal notranslate"><span class="pre">k_retriever</span></code> (1) and high <code class="docutils literal notranslate"><span class="pre">k_reader_per_candidate</span></code> (20).
For this setting, and this dataset, the <code class="docutils literal notranslate"><span class="pre">top_k</span> <span class="pre">accuracy</span></code> is 52%.
Better results might be achieved with custom pipelines or title boosting and this will be further investigated.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./piaf/reader"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="report_cnil.html" title="previous page">Performance on CNIL Dataset</a>
    <a class='right-next' id="next-link" href="../retriever/index.html" title="next page">Retriever Module</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By etalab-ia<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>